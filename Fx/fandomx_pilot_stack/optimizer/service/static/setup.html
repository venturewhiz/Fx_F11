<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FandomX Fx Optimizer — Setup</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin: 20px; }
    .row { display:flex; gap:16px; flex-wrap:wrap; }
    .card { border:1px solid #ddd; border-radius:10px; padding:14px; min-width: 320px; flex:1; }
    input, textarea, select { width: 100%; padding: 8px; border:1px solid #ccc; border-radius:8px; margin-top:6px; }
    button { padding: 8px 12px; border-radius: 8px; border: 1px solid #111; background: #111; color: #fff; cursor: pointer; margin-top: 10px;}
    button.secondary { background: #fff; color:#111; border:1px solid #ccc; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:6px; }
    .muted { color:#666; font-size: 13px;}
    a { color: #0b57d0; text-decoration:none; }
  </style>
</head>
<body>
  <h1>Setup</h1>
  <div class="muted">Create tenants (Sydney FC, Pepsi) + their entities. Stores metadata in Postgres for ops visibility.</div>
  <div style="margin:10px 0 16px;">
    <a href="/ui/index.html">← Back to Dashboard</a>
  </div>

  <div class="card" style="max-width:520px;">
    <h3>Admin Token (optional)</h3>
    <div class="muted">If you set <code>ADMIN_TOKEN</code> env var on the service, enter the same value here.</div>
    <input id="token" placeholder="Enter admin token (optional)"/>
    <button class="secondary" onclick="saveToken()">Save token</button>
  </div>

  <div class="row" style="margin-top:16px;">
    <div class="card">
      <h3>Create Tenant</h3>
      <input id="tenant_id" placeholder="tenant_id (e.g., SYDFC or PEPSI)"/>
      <input id="tenant_name" placeholder="name (e.g., Sydney FC, Pepsi)"/>
      <textarea id="tenant_meta" placeholder='metadata JSON (optional) e.g. {"region":"AU","contact":"..."}' rows="4"></textarea>
      <button onclick="createTenant()">Create Tenant</button>
      <div id="tenant_result" class="muted"></div>
    </div>

    <div class="card">
      <h3>Create Campaign</h3>
      <input id="camp_id" placeholder="campaign_id (e.g., SYDFC_PEPSI_MATCHDAY)"/>
      <input id="camp_tenant" placeholder="tenant_id (SYDFC or PEPSI)"/>
      <select id="camp_channel">
        <option value="meta">meta</option>
        <option value="google">google</option>
        <option value="youtube">youtube</option>
        <option value="dsp">dsp</option>
        <option value="ott">ott</option>
        <option value="inapp">inapp</option>
      </select>
      <input id="camp_name" placeholder="campaign name"/>
      <input id="camp_objective" placeholder="objective (optional)"/>
      <select id="camp_status">
        <option value="active">active</option>
        <option value="paused">paused</option>
      </select>
      <textarea id="camp_meta" placeholder='metadata JSON (optional)' rows="4"></textarea>
      <button onclick="createCampaign()">Create Campaign</button>
      <div id="camp_result" class="muted"></div>
    </div>
  </div>

  <div class="row" style="margin-top:16px;">
    <div class="card">
      <h3>Create Segment</h3>
      <input id="seg_id" placeholder="segment_id (e.g., SYD_FANS_HARDCORE)"/>
      <input id="seg_tenant" placeholder="tenant_id"/>
      <input id="seg_name" placeholder="segment name"/>
      <textarea id="seg_def" placeholder='definition JSON (optional)' rows="4"></textarea>
      <button onclick="createSegment()">Create Segment</button>
      <div id="seg_result" class="muted"></div>
    </div>

    <div class="card">
      <h3>Create Creative</h3>
      <input id="cr_id" placeholder="creative_id (e.g., CR_7)"/>
      <input id="cr_tenant" placeholder="tenant_id"/>
      <input id="cr_name" placeholder="creative name"/>
      <textarea id="cr_meta" placeholder='metadata JSON (optional)' rows="4"></textarea>
      <button onclick="createCreative()">Create Creative</button>
      <div id="cr_result" class="muted"></div>
    </div>

    <div class="card">
      <h3>Create Offer</h3>
      <input id="off_id" placeholder="offer_id (e.g., OFF_2)"/>
      <input id="off_tenant" placeholder="tenant_id"/>
      <input id="off_name" placeholder="offer name"/>
      <textarea id="off_meta" placeholder='metadata JSON (optional)' rows="4"></textarea>
      <button onclick="createOffer()">Create Offer</button>
      <div id="off_result" class="muted"></div>
    </div>
  </div>

<script>
function headers() {
  const h = {"Content-Type":"application/json"};
  const t = localStorage.getItem("fx_admin_token");
  if (t) h["X-Admin-Token"] = t;
  return h;
}
function saveToken(){
  localStorage.setItem("fx_admin_token", document.getElementById("token").value.trim());
  alert("Saved.");
}
async function post(path, body){
  const res = await fetch(path, {method:"POST", headers: headers(), body: JSON.stringify(body)});
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}
function parseJson(txt){
  const t = (txt || "").trim();
  if (!t) return null;
  return JSON.parse(t);
}

async function createTenant(){
  try{
    const out = await post("/admin/tenants", {
      tenant_id: document.getElementById("tenant_id").value.trim(),
      name: document.getElementById("tenant_name").value.trim(),
      metadata: parseJson(document.getElementById("tenant_meta").value)
    });
    document.getElementById("tenant_result").textContent = "Created: " + out.tenant_id;
  } catch(e){ document.getElementById("tenant_result").textContent = "Error: " + e.message; }
}

async function createCampaign(){
  try{
    const out = await post("/admin/campaigns", {
      campaign_id: document.getElementById("camp_id").value.trim(),
      tenant_id: document.getElementById("camp_tenant").value.trim(),
      channel: document.getElementById("camp_channel").value,
      name: document.getElementById("camp_name").value.trim(),
      objective: document.getElementById("camp_objective").value.trim(),
      status: document.getElementById("camp_status").value,
      metadata: parseJson(document.getElementById("camp_meta").value)
    });
    document.getElementById("camp_result").textContent = "Created: " + out.campaign_id;
  } catch(e){ document.getElementById("camp_result").textContent = "Error: " + e.message; }
}

async function createSegment(){
  try{
    const out = await post("/admin/segments", {
      segment_id: document.getElementById("seg_id").value.trim(),
      tenant_id: document.getElementById("seg_tenant").value.trim(),
      name: document.getElementById("seg_name").value.trim(),
      definition: parseJson(document.getElementById("seg_def").value)
    });
    document.getElementById("seg_result").textContent = "Created: " + out.segment_id;
  } catch(e){ document.getElementById("seg_result").textContent = "Error: " + e.message; }
}

async function createCreative(){
  try{
    const out = await post("/admin/creatives", {
      creative_id: document.getElementById("cr_id").value.trim(),
      tenant_id: document.getElementById("cr_tenant").value.trim(),
      name: document.getElementById("cr_name").value.trim(),
      metadata: parseJson(document.getElementById("cr_meta").value)
    });
    document.getElementById("cr_result").textContent = "Created: " + out.creative_id;
  } catch(e){ document.getElementById("cr_result").textContent = "Error: " + e.message; }
}

async function createOffer(){
  try{
    const out = await post("/admin/offers", {
      offer_id: document.getElementById("off_id").value.trim(),
      tenant_id: document.getElementById("off_tenant").value.trim(),
      name: document.getElementById("off_name").value.trim(),
      metadata: parseJson(document.getElementById("off_meta").value)
    });
    document.getElementById("off_result").textContent = "Created: " + out.offer_id;
  } catch(e){ document.getElementById("off_result").textContent = "Error: " + e.message; }
}
</script>
</body>
</html>
